

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pypo &#8212; PyPO&#39;s documentation.</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/pypo';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/pypo_logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/pypo_logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    PyPO Documentation 1.0.0
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>

<li class="toctree-l1"><a class="reference internal" href="../operability_overview.html">Process Operability Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms.html">Process Operability Algorithms</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api.html">API Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/pypo.html">pypo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples_gallery/index_example_gallery.html">Examples Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/victoraalves/python_operability" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/victoraalves/python_operability/issues/new?title=Issue%20on%20page%20%2F_modules/pypo.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for pypo</h1><div class="highlight"><pre>
<span></span><span class="c1"># Basic python tools</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">permutations</span> <span class="k">as</span> <span class="n">perms</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span><span class="n">Union</span>
<span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>


<span class="c1"># Linear Algebra</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span>   <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">norm</span> <span class="p">,</span> <span class="n">pinv</span>

<span class="c1"># Optimizitaion algorithms</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">root</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">differential_evolution</span> <span class="k">as</span> <span class="n">DE</span>
<span class="kn">from</span> <span class="nn">cyipopt</span> <span class="kn">import</span> <span class="n">minimize_ipopt</span>

<span class="c1"># Polytopic calculations</span>
<span class="kn">import</span> <span class="nn">polytope</span> <span class="k">as</span> <span class="nn">pc</span>
<span class="kn">from</span> <span class="nn">polytope.polytope</span> <span class="kn">import</span> <span class="n">region_diff</span>
<span class="kn">from</span> <span class="nn">polytope.polytope</span> <span class="kn">import</span> <span class="n">_get_patch</span>




<span class="c1"># Plots</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d.art3d</span> <span class="kn">import</span> <span class="n">Poly3DCollection</span>



<span class="c1"># Setting default plot options</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">cmap</span> <span class="o">=</span>  <span class="s1">&#39;rainbow&#39;</span>
<span class="n">lineweight</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">edgecolors</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
<span class="n">markersize</span> <span class="o">=</span>  <span class="mi">128</span>


<div class="viewcode-block" id="multimodel_rep"><a class="viewcode-back" href="../api.html#pypo.multimodel_rep">[docs]</a><span class="k">def</span> <span class="nf">multimodel_rep</span><span class="p">(</span><span class="n">AIS_bound</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
                  <span class="n">resolution</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
                  <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
                  <span class="n">polytopic_trace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;simplices&#39;</span><span class="p">,</span>
                  <span class="n">perspective</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;outputs&#39;</span><span class="p">,</span>
                  <span class="n">plotting</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Obtain a multimodel representation based on polytopes of Process Operability</span>
<span class="sd">    sets. This procedure is essential for evaluating the Operability Index (OI).</span>
<span class="sd">    </span>
<span class="sd">    This function is part of Python-based Process Operability package.</span>
<span class="sd">    </span>
<span class="sd">    Control, Optimization and Design for Energy and Sustainability (CODES) </span>
<span class="sd">    Group - West Virginia University - 2022/2023</span>
<span class="sd">    </span>
<span class="sd">    Author: Victor Alves</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    AIS_bound : np.ndarray</span>
<span class="sd">        Bounds on the Available Input Set (AIS). Each row corresponds to the </span>
<span class="sd">        lower and upper bound of each AIS variable.</span>
<span class="sd">    resolution : np.ndarray</span>
<span class="sd">        Array containing the resolution of the discretization grid for the AIS.</span>
<span class="sd">        Each element corresponds to the resolution of each variable. For a </span>
<span class="sd">        resolution defined as k, it will generate d^k points (in which d is the</span>
<span class="sd">        dimensionality of the AIS).</span>
<span class="sd">    model : Callable[...,Union[float,np.ndarray]]</span>
<span class="sd">        Process model that calculates the relationship between inputs (AIS-DIS) </span>
<span class="sd">        and Outputs (AOS-DOS).</span>
<span class="sd">    polytopic_trace: str, Optional.</span>
<span class="sd">        Determines if the polytopes will be constructed using simplices or</span>
<span class="sd">        polyhedrons. Default is &#39;simplices&#39;. Additional option is &#39;polyhedra&#39;.</span>
<span class="sd">    perspective: str, Optional.</span>
<span class="sd">        Defines if the calculation is to be done from the inputs/outputs</span>
<span class="sd">        perspective. Affects only labels in plots. Default is &#39;outputs&#39;.</span>
<span class="sd">    plotting: str, Optional.</span>
<span class="sd">        Defines if the plotting of operability sets is desired (If the dimension</span>
<span class="sd">        is &lt;= 3). Default is &#39;True&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    finalpolytope : list</span>
<span class="sd">        List with first argument being a convex polytope or collection of </span>
<span class="sd">        convex polytopes (named as Region) </span>
<span class="sd">        that describes the AOS. Can be used to calculate the Operability Index </span>
<span class="sd">        using ``OI_eval``. Second argument is the coordinates of the AOS as a</span>
<span class="sd">        numpy array.</span>
<span class="sd">        </span>
<span class="sd">    </span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    [1]  D. R., Vinson and C. Georgakis.  New Measure of Process Output </span>
<span class="sd">    Controllability. J. Process Control, 2000. </span>
<span class="sd">    https://doi.org/10.1016/S0959-1524(99)00045-1</span>
<span class="sd">    </span>
<span class="sd">    [2]  C. Georgakis, D. Uzt√ºrk, S. Subramanian, and D. R. Vinson. On the </span>
<span class="sd">    Operability of Continuous Processes. Control Eng. Pract., 2003. </span>
<span class="sd">    https://doi.org/10.1016/S0967-0661(02)00217-4</span>
<span class="sd">    </span>
<span class="sd">    [3] V.Gazzaneo, J. C. Carrasco, D. R. Vinson, and F. V. Lima. Process </span>
<span class="sd">    Operability Algorithms: Past, Present, and Future Developments.</span>
<span class="sd">    Ind. &amp; Eng. Chem. Res. 59 (6), 2457-2470, 2020.</span>
<span class="sd">    https://doi.org/10.1021/acs.iecr.9b05181</span>
<span class="sd">                                 </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># TODO: Add implicit mapping option to perform any multimodel rep </span>
    <span class="c1">#(future release).</span>
    <span class="c1"># Map AOS from AIS setup.</span>
    
    <span class="n">AIS</span><span class="p">,</span> <span class="n">AOS</span> <span class="o">=</span>  <span class="n">AIS2AOS_map</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">AIS_bound</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    
    <span class="c1"># if perspective == &#39;outputs&#39;:</span>
    <span class="c1">#     AIS, AOS =  AIS2AOS_map(model, AIS_bound, resolution)</span>
    <span class="c1"># else:</span>
    <span class="c1">#     u0 = input(&#39;Enter an initial estimate for your inverse model&#39;)</span>
    <span class="c1">#     u0 = np.array(u0, dtype=float)</span>
    <span class="c1">#     AIS, AOS, _ = nlp_based_approach(AIS_bound, resolution, model, </span>
    <span class="c1">#                                               u0, -np.inf, +np.inf, </span>
    <span class="c1">#                                               method=&#39;ipopt&#39;, </span>
    <span class="c1">#                                               plot=False, </span>
    <span class="c1">#                                               ad=False,</span>
    <span class="c1">#                                               warmstart=True)</span>
        
    
    
    <span class="k">if</span>  <span class="n">polytopic_trace</span>  <span class="o">==</span><span class="s1">&#39;simplices&#39;</span><span class="p">:</span>
        <span class="n">AIS_poly</span><span class="p">,</span> <span class="n">AOS_poly</span> <span class="o">=</span> <span class="n">points2simplices</span><span class="p">(</span><span class="n">AIS</span><span class="p">,</span><span class="n">AOS</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">polytopic_trace</span> <span class="o">==</span><span class="s1">&#39;polyhedra&#39;</span><span class="p">:</span>
        <span class="n">AIS_poly</span><span class="p">,</span> <span class="n">AOS_poly</span> <span class="o">=</span> <span class="n">points2polyhedra</span><span class="p">(</span><span class="n">AIS</span><span class="p">,</span><span class="n">AOS</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Invalid option for polytopic tracing. Exiting algorithm.&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        
        
    
    <span class="c1"># Define empty polyopes list</span>
    <span class="n">Polytope</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">Vertices_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="c1"># Create convex hull using the vertices of the AOS</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">AOS_poly</span><span class="p">)):</span>
        <span class="n">Vertices</span> <span class="o">=</span> <span class="n">AOS_poly</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">Vertices_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Vertices</span><span class="p">)</span>
        <span class="n">Polytope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pc</span><span class="o">.</span><span class="n">qhull</span><span class="p">(</span><span class="n">Vertices</span><span class="p">))</span>
        
    
    <span class="c1"># Define the AOS as an (possibly) overlapped region. This will be fixed in</span>
    <span class="c1"># the next lines of code.    </span>
    <span class="n">overlapped_region</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span><span class="n">Polytope</span><span class="p">[</span><span class="mi">0</span><span class="p">:])</span>
    
    <span class="c1"># Create a bounding box of the region above:</span>
    <span class="n">min_coord</span> <span class="o">=</span>  <span class="n">overlapped_region</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">max_coord</span> <span class="o">=</span>  <span class="n">overlapped_region</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">box_coord</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">min_coord</span><span class="p">,</span> <span class="n">max_coord</span><span class="p">])</span>
    <span class="n">bound_box</span> <span class="o">=</span>  <span class="n">pc</span><span class="o">.</span><span class="n">box2poly</span><span class="p">(</span><span class="n">box_coord</span><span class="p">)</span>

    <span class="c1"># Remove overlapping (Gazzaneo&#39;s trick) - Remove one polytope at a time, </span>
    <span class="c1"># create void polytope using the bounding box and subtract from the original </span>
    <span class="c1"># bounding box itself.</span>
    <span class="n">RemPoly</span> <span class="o">=</span> <span class="p">[</span><span class="n">bound_box</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Polytope</span><span class="p">)):</span>
        <span class="n">RemPolyList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">RemPoly</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">temp_diff</span> <span class="o">=</span> <span class="n">RemPoly</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Polytope</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">temp_diff</span><span class="p">))</span> <span class="o">==</span> <span class="s2">&quot;&lt;class &#39;polytope.polytope.Polytope&#39;&gt;&quot;</span><span class="p">:</span>
                <span class="n">temp_diff</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_diff</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp_diff</span><span class="p">)):</span>
                <span class="n">RemPolyList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_diff</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                
        <span class="n">RemPoly</span> <span class="o">=</span> <span class="n">RemPolyList</span>
    
    <span class="n">RemU</span> <span class="o">=</span>  <span class="n">RemPoly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">RemPoly</span><span class="p">)):</span>
        <span class="n">RemU</span> <span class="o">=</span> <span class="n">RemU</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">RemPoly</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
        
    <span class="c1"># Generate final (non-overlapped) polytope</span>
    <span class="n">finalpolytope</span> <span class="o">=</span> <span class="n">region_diff</span><span class="p">(</span><span class="n">bound_box</span><span class="p">,</span> <span class="n">RemU</span><span class="p">)</span>

    <span class="c1"># Perspective switch: This will only affect plotting and legends.</span>
    <span class="k">if</span> <span class="n">perspective</span> <span class="o">==</span> <span class="s1">&#39;outputs&#39;</span><span class="p">:</span>
        <span class="n">AS_label</span> <span class="o">=</span> <span class="s1">&#39;Achievable Output Set (AOS)&#39;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">AS_label</span> <span class="o">=</span> <span class="s1">&#39;Available Input Set (AIS)&#39;</span>

    <span class="k">if</span> <span class="n">plotting</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">finalpolytope</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            
            
            <span class="n">polyplot</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="n">AS_COLOR</span> <span class="o">=</span> <span class="s1">&#39;#2ca02c&#39;</span>
            <span class="n">AS_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">Vertices_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">finalpolytope</span><span class="p">)):</span>

                <span class="n">polyplot</span> <span class="o">=</span> <span class="n">_get_patch</span><span class="p">(</span><span class="n">finalpolytope</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
                                    <span class="n">edgecolor</span><span class="o">=</span><span class="n">AS_COLOR</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                    <span class="n">facecolor</span><span class="o">=</span><span class="n">AS_COLOR</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">polyplot</span><span class="p">)</span>


            <span class="n">lower_xaxis</span> <span class="o">=</span> <span class="n">finalpolytope</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">upper_xaxis</span> <span class="o">=</span> <span class="n">finalpolytope</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">lower_yaxis</span> <span class="o">=</span> <span class="n">finalpolytope</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">upper_yaxis</span> <span class="o">=</span> <span class="n">finalpolytope</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lower_xaxis</span> <span class="o">-</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">lower_xaxis</span><span class="p">,</span>
                        <span class="n">upper_xaxis</span> <span class="o">+</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">upper_xaxis</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">lower_yaxis</span> <span class="o">-</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">lower_yaxis</span><span class="p">,</span>
                        <span class="n">upper_yaxis</span> <span class="o">+</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">upper_yaxis</span><span class="p">)</span>

            
            <span class="n">AS_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">AS_COLOR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">AS_label</span><span class="p">)</span>

            <span class="n">extra</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
                                    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">perspective</span> <span class="o">==</span> <span class="s1">&#39;outputs&#39;</span><span class="p">:</span>
                <span class="n">str_title</span> <span class="o">=</span> <span class="s1">&#39;Achievable Output Set (AOS)&#39;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">str_title</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">str_title</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">capwords</span><span class="p">(</span>
                    <span class="s2">&quot;Available Input set (AIS)&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">str_title</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">AS_patch</span><span class="p">,</span> <span class="n">extra</span><span class="p">])</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            
        <span class="k">elif</span> <span class="n">finalpolytope</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            
            
            <span class="n">polyplot</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
            <span class="n">AS_COLOR</span> <span class="o">=</span> <span class="s1">&#39;#2ca02c&#39;</span>
            <span class="n">AS_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">Vertices_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">cube</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">AS_coords</span><span class="p">],</span> <span class="p">[</span><span class="n">AS_COLOR</span><span class="p">]):</span>
                <span class="n">hull</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">ConvexHull</span><span class="p">(</span><span class="n">cube</span><span class="p">)</span>
                <span class="c1"># draw the polygons of the convex hull</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">hull</span><span class="o">.</span><span class="n">simplices</span><span class="p">:</span>
                    <span class="n">tri</span> <span class="o">=</span> <span class="n">Poly3DCollection</span><span class="p">([</span><span class="n">cube</span><span class="p">[</span><span class="n">s</span><span class="p">]])</span>
                    <span class="n">tri</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
                    <span class="n">tri</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">tri</span><span class="p">)</span>
                <span class="c1"># draw the vertices</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cube</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">cube</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">cube</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> 
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            
            <span class="n">AS_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">AS_COLOR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">AS_label</span><span class="p">)</span>

            <span class="n">extra</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
                                    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">perspective</span> <span class="o">==</span> <span class="s1">&#39;outputs&#39;</span><span class="p">:</span>
                <span class="n">str_title</span> <span class="o">=</span> <span class="s1">&#39;Achievable Output Set (AOS)&#39;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">str_title</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">str_title</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">capwords</span><span class="p">(</span>
                    <span class="s2">&quot;Available Input set (AIS)&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">str_title</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">AS_patch</span><span class="p">,</span> <span class="n">extra</span><span class="p">])</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{3}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting not supported. Dimension different greater than 3.&#39;</span><span class="p">)</span>
            <span class="n">AS_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">Vertices_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Either plotting is not possible (dimension &gt; 3) or you have&#39;</span><span class="p">,</span>
              <span class="s1">&#39;chosen plotting=False. The operability set is still returned as&#39;</span><span class="p">,</span>
              <span class="s1">&#39;a polytopic region of general dimension.&#39;</span><span class="p">)</span>
        <span class="n">AS_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">Vertices_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    
    <span class="c1"># Small hack: Inject AS coordinates into return to be able to</span>
    <span class="c1"># plot 3d region effortlessly.</span>
    <span class="n">finalpolytope_object</span> <span class="o">=</span> <span class="p">[</span><span class="n">finalpolytope</span><span class="p">,</span> <span class="n">AS_coords</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">finalpolytope_object</span></div>


<div class="viewcode-block" id="OI_eval"><a class="viewcode-back" href="../api.html#pypo.OI_eval">[docs]</a><span class="k">def</span> <span class="nf">OI_eval</span><span class="p">(</span><span class="n">AS</span><span class="p">:</span> <span class="n">pc</span><span class="o">.</span><span class="n">Region</span><span class="p">,</span>
       <span class="n">DS</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">perspective</span>  <span class="o">=</span> <span class="s1">&#39;outputs&#39;</span><span class="p">,</span>
       <span class="n">hypervol_calc</span><span class="p">:</span>           <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;robust&#39;</span><span class="p">,</span>
       <span class="n">plotting</span><span class="p">:</span>                <span class="nb">str</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Operability Index (OI) calculation. From a Desired Output</span>
<span class="sd">    Set (DOS) defined by the user, this function calculates the intersection</span>
<span class="sd">    between achievable (AOS) and desired output operation (DOS). Similarly, the </span>
<span class="sd">    OI can be also calculated from the inputs&#39; perspective, as an intersection</span>
<span class="sd">    between desired input (DIS) and available input (AIS). This function is able</span>
<span class="sd">    to  evaluate the OI in any dimension, ranging from 1-d (length) up to</span>
<span class="sd">    higher dimensions (Hypervolumes, &gt; 3-d), aided by the Polytope package.</span>
<span class="sd">    </span>
<span class="sd">    This function is part of Python-based Process Operability package.</span>
<span class="sd">    </span>
<span class="sd">    Control, Optimization and Design for Energy and Sustainability (CODES) </span>
<span class="sd">    Group - West Virginia University - 2022/2023</span>
<span class="sd">    </span>
<span class="sd">    Author: Victor Alves</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    AS : pc.Region</span>
<span class="sd">        Available input set (AIS) or Achievable output set (AOS) represented as</span>
<span class="sd">        a series of paired (and convex) polytopes. This region is easily </span>
<span class="sd">        obtained using the multimodel_rep function.</span>
<span class="sd">    DS: np.ndarray</span>
<span class="sd">        Array containing the desired operation, either in the inputs (DIS) or</span>
<span class="sd">        outputs perspective (DOS).</span>
<span class="sd">    perspective: str, Optional.</span>
<span class="sd">        String that determines in which perspective the OI will be evaluated:</span>
<span class="sd">        inputs or outputs. default is &#39;outputs&#39;.</span>
<span class="sd">    hypervol_calc: str, Optional.</span>
<span class="sd">        Determines how the approach when evaluating hypervolumes. Default is</span>
<span class="sd">        &#39;robust&#39;, an implementation that switches from qhull&#39;s hypervolume</span>
<span class="sd">        evaluation or polytope&#39;s evaluation depending on the dimensionality of</span>
<span class="sd">        the problem. Additional option is &#39;polytope&#39;, Polytope&#39;s package own</span>
<span class="sd">        implementation of hypervolumes evaluation being used in problems of </span>
<span class="sd">        any dimension.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    OI: float</span>
<span class="sd">        Operability Index value. Ranges from 0 to 100%. A fully operable </span>
<span class="sd">        process has OI = 100% and if not fully operable, OI &lt; 100%.</span>
<span class="sd">    </span>
<span class="sd">        </span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    [1]  D. R., Vinson and C. Georgakis.  New Measure of Process Output </span>
<span class="sd">    Controllability. J. Process Control, 2000. </span>
<span class="sd">    https://doi.org/10.1016/S0959-1524(99)00045-1</span>
<span class="sd">    </span>
<span class="sd">    [2]  C. Georgakis, D. Uzt√ºrk, S. Subramanian, and D. R. Vinson. On the </span>
<span class="sd">    Operability of Continuous Processes. Control Eng. Pract., 2003. </span>
<span class="sd">    https://doi.org/10.1016/S0967-0661(02)00217-4</span>
<span class="sd">    </span>
<span class="sd">    [3] V.Gazzaneo, J. C. Carrasco, D. R. Vinson, and F. V. Lima. Process </span>
<span class="sd">    Operability Algorithms: Past, Present, and Future Developments.</span>
<span class="sd">    Ind. &amp; Eng. Chem. Res. 59 (6), 2457-2470, 2020.</span>
<span class="sd">    https://doi.org/10.1021/acs.iecr.9b05181</span>

<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1"># Defining Polytopes for manipulation. Obatining polytopes in min-rep if</span>
    <span class="c1"># applicable.</span>

    <span class="n">DS_region</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">box2poly</span><span class="p">(</span><span class="n">DS</span><span class="p">)</span>
    <span class="n">AS_region</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">AS</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">DS_region</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">DS_region</span><span class="p">)</span>
    <span class="n">inter_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">AS_region</span><span class="p">)):</span>
        <span class="n">intersection</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">AS_region</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">DS_region</span><span class="p">)</span>
        <span class="n">inter_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span>
    
    <span class="n">intersection</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span><span class="n">inter_list</span><span class="p">)</span>
    <span class="n">v_intersect_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">hypervol_calc</span> <span class="o">==</span> <span class="s1">&#39;polytope&#39;</span><span class="p">:</span>
        <span class="n">OI</span> <span class="o">=</span> <span class="p">(</span><span class="n">intersection</span><span class="o">.</span><span class="n">volume</span><span class="o">/</span><span class="n">DS_region</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>

    <span class="k">elif</span> <span class="n">hypervol_calc</span> <span class="o">==</span> <span class="s1">&#39;robust&#39;</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">DS_region</span><span class="o">.</span><span class="n">dim</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">intersect_i</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">each_volume_list</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intersection</span><span class="p">)):</span>
                <span class="n">intersect_i</span> <span class="o">=</span> <span class="n">intersection</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">v_intersect</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">extreme</span><span class="p">(</span><span class="n">intersect_i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v_intersect</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">v_intersect_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_intersect</span><span class="p">)</span>
                    <span class="n">each_volume_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">ConvexHull</span><span class="p">(</span><span class="n">v_intersect</span><span class="p">)</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span>
                    
                
            <span class="n">each_volume</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">each_volume_list</span><span class="p">)</span>
            <span class="n">intersection_volume</span> <span class="o">=</span> <span class="n">each_volume</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    
            <span class="n">v_DS</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">extreme</span><span class="p">(</span><span class="n">DS_region</span><span class="p">)</span>
            
            <span class="c1"># Evaluate OI</span>
            <span class="n">OI</span> <span class="o">=</span> <span class="p">(</span><span class="n">intersection_volume</span> <span class="o">/</span> <span class="n">sp</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">ConvexHull</span><span class="p">(</span><span class="n">v_DS</span><span class="p">)</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;For higher dimensions (&gt;7) polytope&#39;s hypervolume estimation </span><span class="se">\</span>
<span class="s2">                  is faster. Switching to polytope&#39;s calculation.&quot;</span><span class="p">)</span>
            <span class="n">OI</span> <span class="o">=</span> <span class="p">(</span><span class="n">intersection</span><span class="o">.</span><span class="n">volume</span><span class="o">/</span><span class="n">DS_region</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Invalid hypervolume calculation option. Exiting algorithm.&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>



    <span class="c1"># Perspective switch: This will only affect plotting and legends.</span>
    <span class="k">if</span> <span class="n">perspective</span> <span class="o">==</span> <span class="s1">&#39;outputs&#39;</span><span class="p">:</span>
        <span class="n">DS_label</span> <span class="o">=</span> <span class="s1">&#39;Desired Output Set (DOS)&#39;</span>
        <span class="n">AS_label</span> <span class="o">=</span> <span class="s1">&#39;Achievable Output Set (AOS)&#39;</span>
        <span class="n">int_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$ AOS \cap DOS$&#39;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">DS_label</span> <span class="o">=</span> <span class="s1">&#39;Desired Input Set (DIS)&#39;</span>
        <span class="n">AS_label</span> <span class="o">=</span> <span class="s1">&#39;Available Input Set (AIS)&#39;</span>
        <span class="n">int_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$ AIS \cap DIS$&#39;</span>

    <span class="c1"># Plotting if 2D/ 3D</span>
    <span class="k">if</span> <span class="n">plotting</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">DS_region</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            
            
            <span class="n">polyplot</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="n">DS_COLOR</span> <span class="o">=</span> <span class="s1">&#39;#7f7f7f&#39;</span>
            <span class="n">INTERSECT_COLOR</span> <span class="o">=</span> <span class="s1">&#39;#1f77b4&#39;</span>
            <span class="n">AS_COLOR</span> <span class="o">=</span> <span class="s1">&#39;#2ca02c&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">AS_region</span><span class="p">)):</span>

                <span class="n">polyplot</span> <span class="o">=</span> <span class="n">_get_patch</span><span class="p">(</span><span class="n">AS_region</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
                                    <span class="n">edgecolor</span><span class="o">=</span><span class="n">AS_COLOR</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                    <span class="n">facecolor</span><span class="o">=</span><span class="n">AS_COLOR</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">polyplot</span><span class="p">)</span>


            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intersection</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">intersection</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">interplot</span> <span class="o">=</span> <span class="n">_get_patch</span><span class="p">(</span><span class="n">intersection</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
                                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                        <span class="n">facecolor</span><span class="o">=</span><span class="n">INTERSECT_COLOR</span><span class="p">,</span> 
                                        <span class="n">edgecolor</span><span class="o">=</span><span class="n">INTERSECT_COLOR</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">interplot</span><span class="p">)</span>
                    

            <span class="n">DSplot</span> <span class="o">=</span> <span class="n">_get_patch</span><span class="p">(</span><span class="n">DS_region</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
                                <span class="n">edgecolor</span><span class="o">=</span><span class="n">DS_COLOR</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                <span class="n">facecolor</span><span class="o">=</span><span class="n">DS_COLOR</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">DSplot</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="s1">&#39;DOS&#39;</span><span class="p">)</span>

            <span class="n">lower_xaxis</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">AS_region</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
                              <span class="n">DS_region</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">upper_xaxis</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">AS_region</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
                              <span class="n">DS_region</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">lower_yaxis</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">AS_region</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> 
                              <span class="n">DS_region</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">upper_yaxis</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">AS_region</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> 
                              <span class="n">DS_region</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lower_xaxis</span> <span class="o">-</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">lower_xaxis</span><span class="p">,</span>
                        <span class="n">upper_xaxis</span> <span class="o">+</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">upper_xaxis</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">lower_yaxis</span> <span class="o">-</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">lower_yaxis</span><span class="p">,</span>
                        <span class="n">upper_yaxis</span> <span class="o">+</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">upper_yaxis</span><span class="p">)</span>

            <span class="n">DS_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">DS_COLOR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">DS_label</span><span class="p">)</span>
            <span class="n">AS_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">AS_COLOR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">AS_label</span><span class="p">)</span>
            <span class="n">INTERSECT_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">INTERSECT_COLOR</span><span class="p">,</span>
                                            <span class="n">label</span><span class="o">=</span><span class="n">int_label</span><span class="p">)</span>


            <span class="n">OI_str</span> <span class="o">=</span> <span class="s1">&#39;Operability Index = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">OI</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>

            <span class="n">extra</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
                                    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">OI_str</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">perspective</span> <span class="o">==</span> <span class="s1">&#39;outputs&#39;</span><span class="p">:</span>
                <span class="n">str_title</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">capwords</span><span class="p">(</span>
                    <span class="s2">&quot;Operability Index Evaluation - Outputs&#39; perspective&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">str_title</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">str_title</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">capwords</span><span class="p">(</span>
                    <span class="s2">&quot;Operability Index Evaluation - Inputs&#39; perspective&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">str_title</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">DS_patch</span><span class="p">,</span> <span class="n">AS_patch</span><span class="p">,</span> <span class="n">INTERSECT_patch</span><span class="p">,</span> <span class="n">extra</span><span class="p">])</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="k">elif</span> <span class="n">DS_region</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            
            <span class="n">AS_coords</span> <span class="o">=</span> <span class="n">AS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">DS_coords</span> <span class="o">=</span> <span class="n">get_extreme_vertices</span><span class="p">(</span><span class="n">DS</span><span class="p">)</span>
            <span class="n">polyplot</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
            <span class="n">AS_COLOR</span> <span class="o">=</span> <span class="s1">&#39;#2ca02c&#39;</span>
            <span class="n">DS_COLOR</span> <span class="o">=</span> <span class="s1">&#39;#7f7f7f&#39;</span>
            <span class="n">INTERSECT_COLOR</span> <span class="o">=</span> <span class="s1">&#39;#1f77b4&#39;</span>
            <span class="n">intersect_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">v_intersect_list</span><span class="p">,</span>  <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
           
            
            <span class="k">for</span> <span class="n">cube</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">AS_coords</span><span class="p">,</span> <span class="n">DS_coords</span><span class="p">,</span> <span class="n">intersect_coords</span><span class="p">],</span> 
                                   <span class="p">[</span><span class="n">AS_COLOR</span><span class="p">,</span> <span class="n">DS_COLOR</span><span class="p">,</span> <span class="n">INTERSECT_COLOR</span><span class="p">]):</span>
                <span class="n">hull</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">ConvexHull</span><span class="p">(</span><span class="n">cube</span><span class="p">)</span>
                <span class="c1"># draw the polygons of the convex hull</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">hull</span><span class="o">.</span><span class="n">simplices</span><span class="p">:</span>
                    <span class="n">tri</span> <span class="o">=</span> <span class="n">Poly3DCollection</span><span class="p">([</span><span class="n">cube</span><span class="p">[</span><span class="n">s</span><span class="p">]])</span>
                    <span class="n">tri</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
                    <span class="n">tri</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">tri</span><span class="p">)</span>
                <span class="c1"># draw the vertices</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cube</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">cube</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">cube</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> 
                           <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            
            <span class="n">AS_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">AS_COLOR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">AS_label</span><span class="p">)</span>

            <span class="n">extra</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
                                    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">perspective</span> <span class="o">==</span> <span class="s1">&#39;outputs&#39;</span><span class="p">:</span>
                <span class="n">str_title</span> <span class="o">=</span> <span class="s1">&#39;Achievable Output Set (AOS)&#39;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">str_title</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">str_title</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">capwords</span><span class="p">(</span>
                    <span class="s2">&quot;Available Input set (AIS)&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">str_title</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">AS_patch</span><span class="p">,</span> <span class="n">extra</span><span class="p">])</span>
            


            <span class="n">OI_str</span> <span class="o">=</span> <span class="s1">&#39;Operability Index = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">OI</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>

            <span class="n">extra</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
                                    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">OI_str</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">perspective</span> <span class="o">==</span> <span class="s1">&#39;outputs&#39;</span><span class="p">:</span>
                <span class="n">str_title</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">capwords</span><span class="p">(</span>
                    <span class="s2">&quot;Operability Index Evaluation - Outputs&#39; perspective&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">str_title</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">str_title</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">capwords</span><span class="p">(</span>
                    <span class="s2">&quot;Operability Index Evaluation - Inputs&#39; perspective&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">str_title</span><span class="p">)</span>
            
            <span class="n">DS_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">DS_COLOR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">DS_label</span><span class="p">)</span>
            <span class="n">AS_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">AS_COLOR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">AS_label</span><span class="p">)</span>
            <span class="n">INTERSECT_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">INTERSECT_COLOR</span><span class="p">,</span>
                                            <span class="n">label</span><span class="o">=</span><span class="n">int_label</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">DS_patch</span><span class="p">,</span> <span class="n">AS_patch</span><span class="p">,</span> <span class="n">INTERSECT_patch</span><span class="p">,</span> <span class="n">extra</span><span class="p">])</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{3}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting not supported. Dimension different than 2.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Either plotting is not possible (dimension &gt; 3) or you have&#39;</span><span class="p">,</span>
              <span class="s1">&#39;chosen plotting=False. The OI value is still available.&#39;</span><span class="p">)</span>
        
        
    <span class="k">return</span> <span class="n">OI</span></div>


<div class="viewcode-block" id="nlp_based_approach"><a class="viewcode-back" href="../api.html#pypo.nlp_based_approach">[docs]</a><span class="k">def</span> <span class="nf">nlp_based_approach</span><span class="p">(</span><span class="n">DOS_bounds</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                       <span class="n">DOS_resolution</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                       <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span> 
                       <span class="n">u0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                       <span class="n">lb</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                       <span class="n">ub</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                       <span class="n">constr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ipopt&#39;</span><span class="p">,</span> 
                       <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                       <span class="n">ad</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                       <span class="n">warmstart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Inverse mapping for Process Operability calculations. From a Desired Output</span>
<span class="sd">    Set (DOS) defined by the user, this function calculates the closest</span>
<span class="sd">    Feasible Desired Ouput set (DOS*) from the AOS and its respective Feasible</span>
<span class="sd">    Desired Input Set (DIS*), which gives insight about potential changes in</span>
<span class="sd">    design and/or operations of a given process model.</span>
<span class="sd">    </span>
<span class="sd">    This function is part of Python-based Process Operability package.</span>
<span class="sd">    </span>
<span class="sd">    Control, Optimization and Design for Energy and Sustainability (CODES) </span>
<span class="sd">    Group - West Virginia University - 2022</span>
<span class="sd">    </span>
<span class="sd">    Author: Victor Alves</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    DOS_bounds : np.ndarray</span>
<span class="sd">        Array containing the bounds of the Desired Output set (DOS). Each row </span>
<span class="sd">        corresponds to the lower and upper bound of each variable.</span>
<span class="sd">    DOS_resolution: np.ndarray</span>
<span class="sd">        Array containing the resolution of the discretization grid for the DOS.</span>
<span class="sd">        Each element corresponds to the resolution of each variable. For a </span>
<span class="sd">        resolution defined as k, it will generate d^k points (in which d is the</span>
<span class="sd">        dimensionality of the problem).</span>
<span class="sd">    model : Callable[...,Union[float,np.ndarray]]</span>
<span class="sd">        Process model that calculates the relationship between inputs (AIS-DIS) </span>
<span class="sd">        and Outputs (AOS-DOS).</span>
<span class="sd">    u0 : np.ndarray</span>
<span class="sd">        Initial estimate for the inverse mapping at each point. Should have</span>
<span class="sd">        same dimension as model inputs.</span>
<span class="sd">    lb : np.ndarray</span>
<span class="sd">        Lower bound on inputs.</span>
<span class="sd">    ub : np.ndarray</span>
<span class="sd">        Upper bound on inputs.</span>
<span class="sd">    constr : list, optional</span>
<span class="sd">        List of functions containing constraints to the inverse mapping.</span>
<span class="sd">        The default is None. follows scipy.optimize synthax.</span>
<span class="sd">    method: str</span>
<span class="sd">        Optimization method used. The default is DE </span>
<span class="sd">        (Differential evolution from scipy). Set &#39;ipopt&#39; if CyIpopt is </span>
<span class="sd">        installed and want to use gradient-based solver. Options are:</span>
<span class="sd">            For unconstrained problems:</span>
<span class="sd">                </span>
<span class="sd">                -&#39;trust-constr&#39;</span>
<span class="sd">                </span>
<span class="sd">                -&#39;Nelder-Mead&#39;</span>
<span class="sd">                </span>
<span class="sd">                -&#39;ipopt&#39;</span>
<span class="sd">                </span>
<span class="sd">                -&#39;DE&#39;</span>
<span class="sd">                </span>
<span class="sd">            For constrained problems:</span>
<span class="sd">                </span>
<span class="sd">                -&#39;ipopt&#39;</span>
<span class="sd">                </span>
<span class="sd">                -&#39;DE&#39;</span>
<span class="sd">                </span>
<span class="sd">                -&#39;SLSQP&#39;</span>
<span class="sd">                </span>
<span class="sd">    plot: bool</span>
<span class="sd">        Turn on/off plotting. If dimension is d&lt;=3, plotting is available and</span>
<span class="sd">        both the Feasible Desired Output Set (DOS*) and Feasible Desired Input</span>
<span class="sd">        Set (DIS*) are plotted. Default is True.</span>

<span class="sd">    ad: bool</span>
<span class="sd">       Turn on/off use of Automatic Differentiation using JAX. If Jax is </span>
<span class="sd">       installed, high-order data (jacobians, hessians) are obtained using AD.</span>
<span class="sd">       Default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fDIS: np.ndarray</span>
<span class="sd">        Feasible Desired Input Set (DIS*). Array containing the solution for</span>
<span class="sd">        each point of the inverse-mapping.</span>
<span class="sd">    fDIS: np.ndarray</span>
<span class="sd">        Feasible Desired Output Set (DOS*). Array containing the feasible</span>
<span class="sd">        output for each feasible input calculated via inverse-mapping.</span>
<span class="sd">    message_list: list</span>
<span class="sd">        List containing the termination criteria for each optimization run</span>
<span class="sd">        performed for each DOS grid point.</span>
<span class="sd">        </span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    [1] J. C. Carrasco and F. V. Lima, ‚ÄúAn optimization-based operability </span>
<span class="sd">    framework for process design and intensification of modular natural </span>
<span class="sd">    gas utilization systems,‚Äù Comput. &amp; Chem. Eng, 2017. https://doi.org/10.1016/j.compchemeng.2016.12.010</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">NonlinearConstraint</span>
    <span class="c1"># Use JAX.numpy if differentiable programming is available.</span>
    <span class="k">if</span> <span class="n">ad</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
        
        <span class="k">def</span> <span class="nf">p1</span><span class="p">(</span><span class="n">u</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
               <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
               <span class="n">DOSpt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>

            <span class="n">y_found</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

            <span class="n">vector_of_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y_found</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">DOSpt</span><span class="o">.</span><span class="n">T</span><span class="p">])</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">error</span><span class="p">(</span><span class="o">*</span><span class="n">vector_of_f</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">f</span>

        <span class="c1"># Error minimization function</span>
        <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="n">y_achieved</span><span class="p">,</span> <span class="n">y_desired</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">y_achieved</span><span class="o">-</span><span class="n">y_desired</span><span class="p">)</span><span class="o">/</span><span class="n">y_desired</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; You have selected automatic differentiation as a method for&quot;</span>
       <span class="s2">&quot; obtaining higher-order data (Jacobians/Hessian). Make sure your&quot;</span>
       <span class="s2">&quot; process model is JAX-compatible implementation-wise.&quot;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">jax.config</span> <span class="kn">import</span> <span class="n">config</span>
        <span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;jax_enable_x64&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s1">&#39;jax_platform_name&#39;</span><span class="p">,</span> <span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="s1">&#39;jax._src.lib.xla_bridge&#39;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">jacrev</span><span class="p">,</span> <span class="n">grad</span>
        
        
        <span class="k">def</span> <span class="nf">p1</span><span class="p">(</span><span class="n">u</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
               <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
               <span class="n">DOSpt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>

            <span class="n">y_found</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

            <span class="n">vector_of_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y_found</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">DOSpt</span><span class="o">.</span><span class="n">T</span><span class="p">])</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">error</span><span class="p">(</span><span class="o">*</span><span class="n">vector_of_f</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">f</span>

        <span class="c1"># Error minimization function</span>
        
        <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="n">y_achieved</span><span class="p">,</span> <span class="n">y_desired</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">y_achieved</span><span class="o">-</span><span class="n">y_desired</span><span class="p">)</span><span class="o">/</span><span class="n">y_desired</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        
        <span class="c1"># Take gradient and hessian of Objective function</span>
        <span class="n">grad_ad</span> <span class="o">=</span> <span class="n">grad</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
        <span class="c1"># hess_ad = jacrev(grad_ad)</span>
        <span class="c1"># BUG: AD-based hessians are deactivated in ipopt for now due to </span>
        <span class="c1"># Cyipopt`s bug.</span>
        <span class="c1"># https://github.com/mechmotum/cyipopt/issues/175</span>
        <span class="c1"># https://github.com/mechmotum/cyipopt/pull/176</span>
        
        <span class="k">if</span> <span class="n">constr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">constr</span><span class="p">[</span><span class="s1">&#39;jac&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="p">(</span><span class="n">jacrev</span><span class="p">(</span><span class="n">constr</span><span class="p">[</span><span class="s1">&#39;fun&#39;</span><span class="p">]))</span>
            <span class="c1"># constr[&#39;fun&#39;] = jit(constr[&#39;fun&#39;])</span>
            <span class="c1"># BUG: AD-based hessians are deactivated for in ipopt now </span>
            <span class="c1"># due to Cyipopt`s bug.</span>
            <span class="c1"># https://github.com/mechmotum/cyipopt/issues/175</span>
            <span class="c1"># https://github.com/mechmotum/cyipopt/pull/176</span>
            
            <span class="c1"># constr[&#39;hess&#39;] = jit(jacrev(jacrev(constr[&#39;fun&#39;])))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

            
    
    <span class="n">dimDOS</span> <span class="o">=</span> <span class="n">DOS_bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">DOSPts</span> <span class="o">=</span> <span class="n">create_grid</span><span class="p">(</span><span class="n">DOS_bounds</span><span class="p">,</span> <span class="n">DOS_resolution</span><span class="p">)</span>
    <span class="n">DOSPts</span> <span class="o">=</span> <span class="n">DOSPts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dimDOS</span><span class="p">)</span>
    <span class="n">u00</span>    <span class="o">=</span> <span class="n">u0</span>
    <span class="c1"># Initialization of variables</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">u0</span><span class="p">)</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">DOSPts</span><span class="p">)</span>
    <span class="n">fDOS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
    <span class="n">fDIS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
    <span class="n">message_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">))</span>

    <span class="c1"># Input sanitation</span>
    <span class="k">if</span> <span class="n">u0</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">c</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Initial estimate and DOS grid have&quot;</span>
                         <span class="s2">&quot; inconsistent sizes. Check the dimensions&quot;</span>
                         <span class="s2">&quot; of your problem.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">u0</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Initial estimate and given bounds have&quot;</span>
                         <span class="s2">&quot; inconsistent sizes.&quot;</span>
                         <span class="s2">&quot; Check the dimensions&quot;</span>
                         <span class="s2">&quot; of your problem.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">c</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Initial estimate and DOS grid have&quot;</span>
                         <span class="s2">&quot; inconsistent sizes.&quot;</span>
                         <span class="s2">&quot; Check the dimensions&quot;</span>
                         <span class="s2">&quot; of your problem.&quot;</span><span class="p">)</span>

    <span class="c1"># If unbounded, set as +-inf.</span>
    <span class="k">if</span> <span class="n">lb</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">if</span> <span class="n">ub</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="c1"># Inverse-mapping: Run for each DOS grid point</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">r</span><span class="p">)):</span>
        
        <span class="k">if</span> <span class="n">constr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">ad</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;trust-constr&#39;</span><span class="p">:</span>
                    <span class="n">sol</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">u0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                               <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">DOSPts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]),</span>
                                               <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                               <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xtol&#39;</span><span class="p">:</span> <span class="mf">1e-10</span><span class="p">},</span>
                                               <span class="n">jac</span><span class="o">=</span><span class="n">grad_ad</span><span class="p">)</span>
                                                <span class="c1"># , hess = hess_ad)</span>

                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Nelder-Mead&#39;</span><span class="p">:</span>
                    <span class="n">sol</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">u0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                               <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">DOSPts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]),</span>
                                               <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                               <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fatol&#39;</span><span class="p">:</span> <span class="mf">1e-10</span><span class="p">,</span>
                                                        <span class="s1">&#39;xatol&#39;</span><span class="p">:</span> <span class="mf">1e-10</span><span class="p">},</span>
                                               <span class="n">jac</span><span class="o">=</span><span class="n">grad_ad</span><span class="p">)</span>
                                                <span class="c1"># , hess = hess_ad)</span>

                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;ipopt&#39;</span><span class="p">:</span>
                    <span class="n">sol</span> <span class="o">=</span> <span class="n">minimize_ipopt</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">u0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                         <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">DOSPts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]),</span>
                                         <span class="n">jac</span><span class="o">=</span><span class="n">grad_ad</span><span class="p">)</span>
                                         <span class="c1">#, hess = hess_ad)</span>

                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;DE&#39;</span><span class="p">:</span>
                    <span class="n">sol</span> <span class="o">=</span> <span class="n">DE</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">u0</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;best1bin&#39;</span><span class="p">,</span>
                             <span class="n">maxiter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">workers</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">updating</span><span class="o">=</span><span class="s1">&#39;deferred&#39;</span><span class="p">,</span>
                             <span class="n">init</span><span class="o">=</span><span class="s1">&#39;sobol&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">DOSPts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;trust-constr&#39;</span><span class="p">:</span>
                    <span class="n">sol</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">u0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                               <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">DOSPts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]),</span>
                                               <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                               <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xtol&#39;</span><span class="p">:</span> <span class="mf">1e-10</span><span class="p">})</span>

                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Nelder-Mead&#39;</span><span class="p">:</span>
                    <span class="n">sol</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">u0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                               <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">DOSPts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]),</span>
                                               <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                               <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fatol&#39;</span><span class="p">:</span> <span class="mf">1e-10</span><span class="p">,</span>
                                                        <span class="s1">&#39;xatol&#39;</span><span class="p">:</span> <span class="mf">1e-10</span><span class="p">})</span>

                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;ipopt&#39;</span><span class="p">:</span>
                    <span class="n">sol</span> <span class="o">=</span> <span class="n">minimize_ipopt</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">u0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                         <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">DOSPts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]))</span>

                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;DE&#39;</span><span class="p">:</span>
                    <span class="n">sol</span> <span class="o">=</span> <span class="n">DE</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">u0</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;best1bin&#39;</span><span class="p">,</span>
                             <span class="n">maxiter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">workers</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">updating</span><span class="o">=</span><span class="s1">&#39;deferred&#39;</span><span class="p">,</span>
                             <span class="n">init</span><span class="o">=</span><span class="s1">&#39;sobol&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">DOSPts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]))</span>
                

            

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;ipopt&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ad</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                    <span class="n">sol</span> <span class="o">=</span> <span class="n">minimize_ipopt</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">u0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                         <span class="n">constraints</span><span class="o">=</span><span class="p">(</span><span class="n">constr</span><span class="p">),</span>
                                         <span class="n">jac</span><span class="o">=</span><span class="n">grad_ad</span><span class="p">,</span>
                                         <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">DOSPts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]))</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sol</span> <span class="o">=</span> <span class="n">minimize_ipopt</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">u0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                         <span class="n">constraints</span><span class="o">=</span><span class="p">(</span><span class="n">constr</span><span class="p">),</span>
                                         <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">DOSPts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]))</span>

            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;DE&#39;</span><span class="p">:</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="n">DE</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">u0</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;best1bin&#39;</span><span class="p">,</span>
                         <span class="n">maxiter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">workers</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">updating</span><span class="o">=</span><span class="s1">&#39;deferred&#39;</span><span class="p">,</span>
                         <span class="n">init</span><span class="o">=</span><span class="s1">&#39;sobol&#39;</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="p">(</span><span class="n">constr</span><span class="p">),</span>
                         <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">DOSPts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]))</span>

            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;trust-constr&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ad</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">con_fun</span> <span class="o">=</span>  <span class="n">constr</span><span class="p">[</span><span class="s1">&#39;fun&#39;</span><span class="p">]</span>
                    <span class="n">nlc</span> <span class="o">=</span> <span class="n">NonlinearConstraint</span><span class="p">((</span><span class="n">con_fun</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                              <span class="n">jac</span><span class="o">=</span> <span class="p">(</span><span class="n">jacrev</span><span class="p">(</span><span class="n">con_fun</span><span class="p">)),</span>
                                              <span class="n">hess</span><span class="o">=</span><span class="p">(</span><span class="n">jacrev</span><span class="p">(</span><span class="n">jacrev</span><span class="p">(</span><span class="n">con_fun</span><span class="p">))))</span>
                    <span class="n">sol</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">u0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                               <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">DOSPts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]),</span>
                                               <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> 
                                               <span class="n">constraints</span><span class="o">=</span><span class="p">(</span><span class="n">nlc</span><span class="p">),</span>
                                               <span class="n">jac</span><span class="o">=</span><span class="n">grad_ad</span><span class="p">)</span>
                                               <span class="c1"># , hess=hess_ad)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sol</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">u0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                               <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">DOSPts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]),</span>
                                               <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> 
                                               <span class="n">constraints</span><span class="o">=</span><span class="p">(</span><span class="n">nlc</span><span class="p">))</span>

        
        
        <span class="c1"># Append results into fDOS, fDIS and message list for each iteration</span>
        
        <span class="k">if</span> <span class="n">warmstart</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sol</span><span class="o">.</span><span class="n">success</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># print(u0)</span>
                <span class="n">u0</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">u0</span> <span class="o">=</span> <span class="n">u00</span> <span class="c1"># Reboot to first initial estimate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">u0</span> <span class="o">=</span> <span class="n">u00</span> <span class="c1"># Reboot to first initial estimate</span>
            
        
        <span class="k">if</span> <span class="n">ad</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">fDOS</span> <span class="o">=</span> <span class="n">fDOS</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
            <span class="n">fDIS</span> <span class="o">=</span> <span class="n">fDIS</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">ad</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">fDOS</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="n">fDIS</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">x</span>

        <span class="n">message_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fDIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">plot</span> <span class="ow">is</span> <span class="kc">False</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting not supported. Dimension different than 2.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">plot</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figaspect</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># plt.subplot(121)</span>

            <span class="c1"># ax.rcParams[&#39;figure.facecolor&#39;] = &#39;white&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">fDIS</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">fDIS</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                        <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fDOS</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">1</span> <span class="o">+</span> <span class="n">fDOS</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">1</span><span class="p">),</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">lw</span><span class="o">=</span><span class="n">lineweight</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                        <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$u_</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$u_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;DIS*&#39;</span><span class="p">)</span>
            <span class="c1"># plt.show</span>

            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">fDOS</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">fDOS</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                        <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fDOS</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">1</span> <span class="o">+</span> <span class="n">fDOS</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">1</span><span class="p">),</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">lw</span><span class="o">=</span><span class="n">lineweight</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                        <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;DOS*&#39;</span><span class="p">)</span>

            <span class="c1"># plt.show</span>

    <span class="k">return</span> <span class="n">fDIS</span><span class="p">,</span> <span class="n">fDOS</span><span class="p">,</span> <span class="n">message_list</span></div>



<div class="viewcode-block" id="create_grid"><a class="viewcode-back" href="../api.html#pypo.create_grid">[docs]</a><span class="k">def</span> <span class="nf">create_grid</span><span class="p">(</span><span class="n">region_bounds</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">region_resolution</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create a multidimensional, discretized grid, given the bounds and the</span>
<span class="sd">    resolution.</span>
<span class="sd">    </span>
<span class="sd">    This function is part of Python-based Process Operability package.</span>
<span class="sd">    </span>
<span class="sd">    Control, Optimization and Design for Energy and Sustainability (CODES) </span>
<span class="sd">    Group - West Virginia University - 2022/2023</span>
<span class="sd">    </span>
<span class="sd">    Author: San Dinh</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    region_bounds : np.ndarray</span>
<span class="sd">        Numpy array that contains the bounds of a (possibily) multidimensional</span>
<span class="sd">        region. Each row corresponds to the lower and upper bound of each </span>
<span class="sd">        variable that constitutes the hypercube.</span>
<span class="sd">    region_resolution: np.ndarray</span>
<span class="sd">        Array containing the resolution of the discretization grid for the </span>
<span class="sd">        region. Each element corresponds to the resolution of each variable. </span>
<span class="sd">        For a resolution defined as k, it will generate d^k points </span>
<span class="sd">        (in which d is the dimensionality of the problem).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    region_grid: np.ndarray</span>
<span class="sd">        Multidimensional array that represents the grid descritization of the</span>
<span class="sd">        region in Euclidean coordinates.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Indexing</span>
    <span class="n">numInput</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">region_resolution</span><span class="p">)</span>
    <span class="n">nInput</span> <span class="o">=</span> <span class="n">region_bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Input_u</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Create discretized region based on bounds and resolution information.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nInput</span><span class="p">):</span>
        <span class="n">Input_u</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">region_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                        <span class="n">region_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                        <span class="n">region_resolution</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>

    <span class="c1"># Create slack variables for preallocation purposes.</span>
    <span class="n">region_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">region_resolution</span> <span class="o">+</span> <span class="p">[</span><span class="n">nInput</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numInput</span><span class="p">):</span>
        <span class="n">inputID</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nInput</span>
        <span class="n">inputID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">region_resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">region_val</span> <span class="o">=</span> <span class="p">[</span><span class="n">Input_u</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">inputID</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nInput</span><span class="p">):</span>
            <span class="n">inputID</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">region_resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">j</span><span class="p">])),</span>
                                    <span class="n">region_resolution</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">region_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Input_u</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">inputID</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>

        <span class="n">region_grid</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">inputID</span><span class="p">)]</span> <span class="o">=</span> <span class="n">region_val</span>

    <span class="k">return</span> <span class="n">region_grid</span></div>


<div class="viewcode-block" id="AIS2AOS_map"><a class="viewcode-back" href="../api.html#pypo.AIS2AOS_map">[docs]</a><span class="k">def</span> <span class="nf">AIS2AOS_map</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
     <span class="n">AIS_bound</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
     <span class="n">AIS_resolution</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Forward mapping for Process Operability calculations (From AIS to AOS). </span>
<span class="sd">    From a Available Input Set (AIS) bounds and discretization resolution both</span>
<span class="sd">    defined by the user, </span>
<span class="sd">    this function calculates the corresponding discretized </span>
<span class="sd">    Available Output Set (AOS).</span>
<span class="sd">    </span>
<span class="sd">    This function is part of Python-based Process Operability package.</span>

<span class="sd">    Control, Optimization and Design for Energy and Sustainability </span>
<span class="sd">    (CODES) Group - West Virginia University - 2022/2023</span>

<span class="sd">    Authors: San Dinh &amp; Victor Alves</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model : Callable[...,Union[float,np.ndarray]]</span>
<span class="sd">        Process model that calculates the relationship between inputs (AIS)</span>
<span class="sd">        and Outputs (AOS).</span>
<span class="sd">    AIS_bound : np.ndarray</span>
<span class="sd">        Lower and upper bounds for the Available Input Set (AIS).</span>
<span class="sd">    AIS_resolution : np.ndarray</span>
<span class="sd">        Resolution for the Available Input Set (AIS). This will be used to</span>
<span class="sd">        discretized the AIS.</span>
<span class="sd">    plot: bool</span>
<span class="sd">        Turn on/off plotting. If dimension is d&lt;=3, plotting is available and</span>
<span class="sd">        both the Achievable Output Set (AOS) and Available Input</span>
<span class="sd">        Set (AIS) are plotted. Default is True.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    AIS : np.ndarray</span>
<span class="sd">        Discretized Available Input Set (AIS).</span>
<span class="sd">    AOS : TYPE</span>
<span class="sd">        Discretized Available Output Set (AIS).</span>

<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1"># Indexing</span>
    <span class="n">numInput</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">AIS_resolution</span><span class="p">)</span>
    <span class="n">nInput</span> <span class="o">=</span> <span class="n">AIS_bound</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Input_u</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Create discretized AIS based on bounds and resolution information.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nInput</span><span class="p">):</span>
        <span class="n">Input_u</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">AIS_bound</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                        <span class="n">AIS_bound</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                        <span class="n">AIS_resolution</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
    <span class="c1"># Create slack variables for preallocation purposes.</span>
    <span class="n">u_slack</span> <span class="o">=</span> <span class="n">AIS_bound</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y_slack</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">u_slack</span><span class="p">)</span>
    <span class="n">nOutput</span> <span class="o">=</span> <span class="n">y_slack</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">AIS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">AIS_resolution</span> <span class="o">+</span> <span class="p">[</span><span class="n">nInput</span><span class="p">])</span>
    <span class="n">AOS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">AIS_resolution</span> <span class="o">+</span> <span class="p">[</span><span class="n">nOutput</span><span class="p">])</span>

    <span class="c1">#</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numInput</span><span class="p">):</span>
        <span class="n">inputID</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nInput</span>
        <span class="n">inputID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">AIS_resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">AIS_val</span> <span class="o">=</span> <span class="p">[</span><span class="n">Input_u</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">inputID</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nInput</span><span class="p">):</span>
            <span class="n">inputID</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">AIS_resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">j</span><span class="p">])),</span>
                                    <span class="n">AIS_resolution</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">AIS_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Input_u</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">inputID</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>

        <span class="n">AIS</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">inputID</span><span class="p">)]</span> <span class="o">=</span> <span class="n">AIS_val</span>
        <span class="n">AOS</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">inputID</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">AIS_val</span><span class="p">)</span>
    
    <span class="c1"># 2D/3D Plots</span>
    <span class="k">if</span> <span class="n">plot</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">AIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">AOS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            
            <span class="n">AIS_plot</span> <span class="o">=</span> <span class="n">AIS</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">AIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">AIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">AOS_plot</span> <span class="o">=</span> <span class="n">AOS</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">AOS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">AOS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">AIS_plot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">AIS_plot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                        <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">lw</span><span class="o">=</span><span class="n">lineweight</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                        <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$u_</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$u_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;AIS&#39;</span><span class="p">)</span>
           

            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                        <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">lw</span><span class="o">=</span><span class="n">lineweight</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                        <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">)</span>
            
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;AOS&#39;</span><span class="p">)</span>

            
        <span class="k">elif</span> <span class="n">AIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">AOS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            
            <span class="n">AIS_plot</span> <span class="o">=</span> <span class="n">AIS</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">AIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">AIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">AOS_plot</span> <span class="o">=</span> <span class="n">AOS</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">AOS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">AOS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figaspect</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">AIS_plot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">AIS_plot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">AIS_plot</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                        <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                                  <span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">lw</span><span class="o">=</span><span class="n">lineweight</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                        <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$u_</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$u_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;$u_</span><span class="si">{3}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;AIS&#39;</span><span class="p">)</span>
            

            
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                        <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> 
                                  <span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">lw</span><span class="o">=</span><span class="n">lineweight</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                        <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{3}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;AOS&#39;</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="n">AIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">AOS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            
            <span class="n">AIS_plot</span> <span class="o">=</span> <span class="n">AIS</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">AIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">AIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">AOS_plot</span> <span class="o">=</span> <span class="n">AOS</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">AOS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">AOS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figaspect</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
            
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">AIS_plot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">AIS_plot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                        <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">lw</span><span class="o">=</span><span class="n">lineweight</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                        <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$u_</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$u_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;AIS&#39;</span><span class="p">)</span>
            
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                        <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> 
                                  <span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">lw</span><span class="o">=</span><span class="n">lineweight</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                        <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{3}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;AOS&#39;</span><span class="p">)</span>
            
            
        <span class="k">elif</span> <span class="n">AIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">AOS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            
            <span class="n">AIS_plot</span> <span class="o">=</span> <span class="n">AIS</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">AIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">AIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">AOS_plot</span> <span class="o">=</span> <span class="n">AOS</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">AOS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">AOS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figaspect</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">AIS_plot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">AIS_plot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">AIS_plot</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                        <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">lw</span><span class="o">=</span><span class="n">lineweight</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                        <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$u_</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$u_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;$u_</span><span class="si">{3}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;AIS&#39;</span><span class="p">)</span>
            
            
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                        <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">AOS_plot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">lw</span><span class="o">=</span><span class="n">lineweight</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                        <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$y_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">)</span>
            
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;AOS&#39;</span><span class="p">)</span>
                
            
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dimension greater than 3, plotting not supported.&#39;</span><span class="p">)</span>
            
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
            
    
    <span class="k">return</span> <span class="n">AIS</span><span class="p">,</span> <span class="n">AOS</span></div>


<div class="viewcode-block" id="points2simplices"><a class="viewcode-back" href="../api.html#pypo.points2simplices">[docs]</a><span class="k">def</span> <span class="nf">points2simplices</span><span class="p">(</span><span class="n">AIS</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">AOS</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                                                                <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generation of connected simplices (k+1 convex hull of k+1 vertices) </span>
<span class="sd">    based on the AIS/AOS points.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    This function is part of Python-based Process Operability package.</span>
<span class="sd">    </span>
<span class="sd">    Control, Optimization and Design for Energy and Sustainability </span>
<span class="sd">    (CODES) Group - West Virginia University - 2022/2023</span>
<span class="sd">    </span>
<span class="sd">    Author: San Dinh</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    AIS : np.ndarray</span>
<span class="sd">        Array containing the points that constitutes the AIS.</span>
<span class="sd">    AOS : np.ndarray</span>
<span class="sd">        Array containing the points that constitutes the AOS.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    AIS_simplices : np.ndarray</span>
<span class="sd">        List of input (AIS) vertices for each simplex generated, in the form of</span>
<span class="sd">        an array.</span>
<span class="sd">    AOS_simplices : np.ndarray</span>
<span class="sd">        List of output (AOS) vertices for each simplex generated, in the form </span>
<span class="sd">        of an array.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Additional parameters: Resolution, no. of inputs/outputs.</span>
    <span class="n">resolution</span> <span class="o">=</span> <span class="n">AIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">nInputVar</span> <span class="o">=</span> <span class="n">AIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">nOutputVar</span> <span class="o">=</span> <span class="n">AOS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">numInput</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>
    <span class="n">nInput</span> <span class="o">=</span> <span class="n">nInputVar</span>

    <span class="n">inputID</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">nInput</span>
    <span class="n">permutations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">perms</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nOutputVar</span><span class="p">)))</span>
    <span class="n">n_simplex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutations</span><span class="p">)</span>
    <span class="n">simplex_vertices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_simplex</span><span class="p">):</span>

        <span class="n">ineq_choice</span> <span class="o">=</span> <span class="n">permutations</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="n">A_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nOutputVar</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">nOutputVar</span><span class="p">))</span>
        <span class="n">A_full</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ineq_choice</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nOutputVar</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">A_full</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ineq_choice</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">A_full</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ineq_choice</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">A_full</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ineq_choice</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">b_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nOutputVar</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">b_full</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">V_simplex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nOutputVar</span><span class="p">,</span> <span class="n">nOutputVar</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nOutputVar</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">A_full</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">b_full</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">V_sol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">V_simplex</span><span class="p">[:,</span> <span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">V_sol</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">simplex_vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">V_simplex</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

    <span class="n">AOS_simplices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">AIS_simplices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numInput</span><span class="p">):</span>
        <span class="n">inputID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nInput</span><span class="p">):</span>
            <span class="n">inputID</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">j</span><span class="p">])),</span>
                                    <span class="n">resolution</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">inputID</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">inputID</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inputID</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_simplex</span><span class="p">):</span>

                <span class="n">ID</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">inputID</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">nInput</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                                            <span class="n">simplex_vertices</span><span class="p">[</span><span class="n">k</span><span class="p">])]</span>

                <span class="n">V_AOS_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nOutputVar</span><span class="p">,</span> <span class="n">nInput</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">V_AIS_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nInputVar</span><span class="p">,</span> <span class="n">nInput</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nInput</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">ID_cell</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ID</span><span class="p">[</span><span class="n">m</span><span class="p">]])</span>
                    <span class="n">V_AOS_id</span><span class="p">[:,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">AOS</span><span class="p">[</span><span class="n">ID_cell</span><span class="p">]</span>
                    <span class="n">V_AIS_id</span><span class="p">[:,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">AIS</span><span class="p">[</span><span class="n">ID_cell</span><span class="p">]</span>

                <span class="n">AOS_simplices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V_AOS_id</span><span class="p">)</span>
                <span class="n">AIS_simplices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V_AIS_id</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">AIS_simplices</span><span class="p">,</span> <span class="n">AOS_simplices</span></div>


<div class="viewcode-block" id="points2polyhedra"><a class="viewcode-back" href="../api.html#pypo.points2polyhedra">[docs]</a><span class="k">def</span> <span class="nf">points2polyhedra</span><span class="p">(</span><span class="n">AIS</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">AOS</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                                                                <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generation of connected polyhedra based on the AIS/AOS points.</span>
<span class="sd">    </span>
<span class="sd">    This function is part of Python-based Process Operability package.</span>
<span class="sd">    </span>
<span class="sd">    Control, Optimization and Design for Energy and Sustainability </span>
<span class="sd">    (CODES) Group - West Virginia University - 2022/2023</span>
<span class="sd">    </span>
<span class="sd">    Author: San Dinh</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    AIS : np.ndarray</span>
<span class="sd">        Array containing the points that constitutes the AIS.</span>
<span class="sd">    AOS : np.ndarray</span>
<span class="sd">        Array containing the points that constitutes the AOS.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    AIS_polytope : np.ndarray</span>
<span class="sd">        List of input (AIS) vertices for each polytope generated, in the form </span>
<span class="sd">        of an array.</span>
<span class="sd">    AOS_polytope : np.ndarray</span>
<span class="sd">        List of output (AOS) vertices for each polyhedra generated, in the form </span>
<span class="sd">        of an array.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Additional parameters: Resolution, no. of inputs/outputs.</span>
    <span class="n">resolution</span> <span class="o">=</span> <span class="n">AIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">nInputVar</span> <span class="o">=</span> <span class="n">AIS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">nOutputVar</span> <span class="o">=</span> <span class="n">AOS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">numInput</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>
    <span class="n">nInput</span> <span class="o">=</span> <span class="n">nInputVar</span>

    <span class="n">inputID</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">nInput</span>
    <span class="n">cube_vertices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">nInput</span><span class="p">)):</span>

        <span class="n">cube_vertices</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">binary_repr</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">nInput</span><span class="p">)])</span>
    <span class="c1"># Preallocation</span>
    <span class="n">AOS_polytope</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">AIS_polytope</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numInput</span><span class="p">):</span>
        <span class="n">inputID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nInput</span><span class="p">):</span>
            <span class="n">inputID</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">j</span><span class="p">])),</span>
                                    <span class="n">resolution</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">inputID</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">inputID</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inputID</span><span class="p">]</span>
            <span class="n">ID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">inputID</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">nInput</span><span class="p">)))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cube_vertices</span><span class="p">)</span>

            <span class="n">V_AOS_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nOutputVar</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">nInput</span><span class="p">)))</span>
            <span class="n">V_AIS_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nInputVar</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">nInput</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">nInput</span><span class="p">)):</span>
                <span class="n">ID_cell</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ID</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span>
                <span class="n">V_AOS_id</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">AOS</span><span class="p">[</span><span class="n">ID_cell</span><span class="p">]</span>
                <span class="n">V_AIS_id</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">AIS</span><span class="p">[</span><span class="n">ID_cell</span><span class="p">]</span>

            <span class="n">AOS_polytope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V_AOS_id</span><span class="p">)</span>
            <span class="n">AIS_polytope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V_AIS_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">AIS_polytope</span><span class="p">,</span> <span class="n">AOS_polytope</span></div>


<div class="viewcode-block" id="implicit_map"><a class="viewcode-back" href="../api.html#pypo.implicit_map">[docs]</a><span class="k">def</span> <span class="nf">implicit_map</span><span class="p">(</span><span class="n">model</span><span class="p">:</span>             <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span> 
                 <span class="n">domain_bound</span><span class="p">:</span>      <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
                 <span class="n">domain_resolution</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
                 <span class="n">image_init</span><span class="p">:</span>        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="p">,</span>
                 <span class="n">direction</span><span class="p">:</span>         <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;forward&#39;</span><span class="p">,</span> 
                 <span class="n">validation</span><span class="p">:</span>        <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;predictor-corrector&#39;</span><span class="p">,</span> 
                 <span class="n">tol_cor</span><span class="p">:</span>           <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> 
                 <span class="n">continuation</span><span class="p">:</span>      <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Explicit RK4&#39;</span><span class="p">,</span>
                 <span class="n">derivative</span><span class="p">:</span>        <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;jax&#39;</span><span class="p">,</span>
                 <span class="n">jit</span><span class="p">:</span>               <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">step_cutting</span><span class="p">:</span>      <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Performs implicit mapping of a implicitly defined process F(u,y) = 0. </span>
<span class="sd">    F can be a vector-valued, multivariable function, which is typically the </span>
<span class="sd">    case for chemical processes studied in Process Operability. </span>
<span class="sd">    This method relies in the implicit function theorem and automatic</span>
<span class="sd">    differentiation in order to obtain the mapping of the required </span>
<span class="sd">    input/output space. The</span>
<span class="sd">    mapping &quot;direction&quot; can be set by changing the &#39;direction&#39; parameter.</span>
<span class="sd">    </span>
<span class="sd">    Authors: San Dinh &amp; Victor Alves</span>
<span class="sd">    </span>
<span class="sd">    Control, Optimization and Design for Energy and Sustainability </span>
<span class="sd">    (CODES) Group - West Virginia University - 2022/2023</span>
<span class="sd">    </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    implicit_model : Callable[...,Union[float,np.ndarray]]</span>
<span class="sd">        Process model that describes the relationship between the input and </span>
<span class="sd">        output spaces. has to be written as a function in the following form:</span>
<span class="sd">            F(Input Vector, Output Vector) = 0</span>
<span class="sd">    domain_bound : np.ndarray</span>
<span class="sd">        Domains of the domain variables. Each row corresponds to the lower and</span>
<span class="sd">        upper bound of each variable. The domain terminology corresponds to the</span>
<span class="sd">        mathematical definition of the domain of a function: If the mapping is</span>
<span class="sd">        in the foward direction (direction = &#39;forward&#39;), then the domain </span>
<span class="sd">        corresponds to the process inputs. Otherwise, the mapping is in the </span>
<span class="sd">        inverse direction and the domain corresponds to the process outputs.</span>
<span class="sd">    domain_resolution : np.ndarray</span>
<span class="sd">        Array containing the resolution of the discretization grid for the domain.</span>
<span class="sd">        Each element corresponds to the resolution of each variable. For a </span>
<span class="sd">        resolution defined as k, it will generate d^k points (in which d is the</span>
<span class="sd">        dimensionality of the domain).</span>
<span class="sd">    direction : str, optional</span>
<span class="sd">        Mapping direction. this will define if a forward or inverse mapping is </span>
<span class="sd">        performed. The default is &#39;forward&#39;.</span>
<span class="sd">    validation : str, optional</span>
<span class="sd">        How the implicit mapping is obatined. The default is &#39;predictor-corrector&#39;.</span>
<span class="sd">        The available options are:</span>
<span class="sd">            &#39;predictor&#39; =&gt; Numerical integration only.</span>
<span class="sd">            </span>
<span class="sd">            &#39;corrector&#39; =&gt; Solved using a nonlinear equation solver.</span>
<span class="sd">            </span>
<span class="sd">            &#39;predictor-corrector&#39; =&gt; Numerical integration + correction using </span>
<span class="sd">            nonlinear equation solver if F(u, y) &gt;= Tolerance.</span>
<span class="sd">        </span>
<span class="sd">    tol_cor : float, optional</span>
<span class="sd">        Tolerance for solution of the implicit function F(u,y) &lt;= tol_cor. </span>
<span class="sd">        The algorithm will keep solving the implicit mapping while</span>
<span class="sd">        F(u,y) &gt;= tol_cor. The default is 1e-4.</span>
<span class="sd">    continuation : str, optional</span>
<span class="sd">        Numerical continuation method used in the implicit mapping.</span>
<span class="sd">        The default is &#39;Explicit RK4&#39; .</span>
<span class="sd">        </span>
<span class="sd">        &#39;Explicit Euler&#39; - Euler&#39;s method. Good for simple (nonstiff) problems.</span>
<span class="sd">        </span>
<span class="sd">        &#39;Explicit RK4&#39;   - Fixed-step 4th order Runge-Kutta. Good for moderate,</span>
<span class="sd">        mildly stiff problems. Good balance between accuracy and complexity.</span>
<span class="sd">        </span>
<span class="sd">        &#39;Odeint&#39;         - Variable step Runge-Kutta. Suitable for challenging,</span>
<span class="sd">        high-dimensional and stiff problems. This is a fully-featured IVP solver.</span>

<span class="sd">    derivative: str, optional</span>
<span class="sd">        Derivative calculation method. If JAX is available, automatic</span>
<span class="sd">        differentiation can be performed. The default is &#39;jax&#39;.</span>
<span class="sd">    jit:  bool True, optional</span>
<span class="sd">        JAX&#39;s Just-in-time compilation (JIT) of implicit function and its </span>
<span class="sd">        respective multidimensional derivatives (Jacobians). JIT allows faster</span>
<span class="sd">        computation of the implicit map. The default is &#39;True&#39;.</span>
<span class="sd">    step_cutting:      bool, False, optional</span>
<span class="sd">        Cutting step strategy to subdivide the domain/image in case of stifness.</span>
<span class="sd">        The default is &#39;False&#39;.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    domain_set: np.ndarray</span>
<span class="sd">        Set of values that corresponds to the domain of the implicit function.</span>
<span class="sd">    image_set: np.ndarray</span>
<span class="sd">        Set of values that corresponds to the calculated image of the implicit</span>
<span class="sd">        function., </span>
<span class="sd">    domain_polyhedra:  list</span>
<span class="sd">        Set of coordinates for polytopic construction of the domain. Can be used</span>
<span class="sd">        to create polytopes for multimodel representation and/or OI evaluation</span>
<span class="sd">        (see multimodel_rep and oi_calc modules)</span>
<span class="sd">    image_polyhedra: list</span>
<span class="sd">        Set of coordinates for polytopic construction of the calculated image</span>
<span class="sd">        of the implicit function. Similarly to &#39;domain_polyhedra&#39;, this list can</span>
<span class="sd">        be used to construct polytopes for multimodel representation and OI</span>
<span class="sd">        evaluation.</span>
<span class="sd">        </span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    V., J. R. Kitchin, and F. V. Lima. &quot;An inverse mapping approach for process</span>
<span class="sd">    systems engineering using automatic differentiation and the implicit </span>
<span class="sd">    function theorem&quot;. AIChE Journal, 2023. </span>
<span class="sd">    https://doi.org/10.1002/aic.18119</span>

<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1"># Implicit function theorem and pre-configuration steps.</span>
    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;forward&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Forward Mapping Selected.&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The given domain is recognized as an Available Input Set (AIS).&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The result of this mapping is an Achievable Output Set(AOS)&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>   <span class="p">:</span> <span class="k">return</span> <span class="n">model</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">F_io</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span> <span class="k">return</span> <span class="n">model</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;inverse&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Inverse Mapping Selected.&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The given domain is recognized as Desired Output Set (DOS).&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The result of this mapping is an Desired Input Set(DIS)&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>   <span class="p">:</span> <span class="k">return</span> <span class="n">model</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">F_io</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span> <span class="k">return</span> <span class="n">model</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Invalid Mapping Selected. Please select the direction </span><span class="se">\</span>
<span class="s1">              to be either &quot;forward&quot; or &quot;inverse&quot;&#39;</span><span class="p">)</span>


    <span class="c1"># Use JAX.numpy if differentiable programming is available.</span>
    <span class="k">if</span> <span class="n">derivative</span> <span class="o">==</span> <span class="s1">&#39;jax&#39;</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">jax.config</span> <span class="kn">import</span> <span class="n">config</span>
        <span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;jax_enable_x64&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">jit</span><span class="p">,</span> <span class="n">jacrev</span>
        <span class="kn">from</span> <span class="nn">jax.experimental.ode</span> <span class="kn">import</span> <span class="n">odeint</span> <span class="k">as</span> <span class="n">odeint</span>
        <span class="n">dFdi</span> <span class="o">=</span> <span class="n">jacrev</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">dFdo</span> <span class="o">=</span> <span class="n">jacrev</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Currently JAX is the only supported option for </span><span class="se">\</span>
<span class="s1">              calculating derivatives. Exiting code.&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

                 

    <span class="k">if</span> <span class="n">jit</span><span class="p">:</span>
        <span class="nd">@jit</span>
        <span class="k">def</span> <span class="nf">dodi</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">oo</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">pinv</span><span class="p">(</span><span class="n">dFdo</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">oo</span><span class="p">))</span> <span class="o">@</span> <span class="n">dFdi</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">oo</span><span class="p">)</span>
        
        <span class="nd">@jit</span>
        <span class="k">def</span> <span class="nf">dods</span><span class="p">(</span><span class="n">oo</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">s_length</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">iplus</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">dodi</span><span class="p">(</span><span class="n">i0</span> <span class="o">+</span> <span class="p">(</span><span class="n">s</span><span class="o">/</span><span class="n">s_length</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">iplus</span> <span class="o">-</span> <span class="n">i0</span><span class="p">),</span> <span class="n">oo</span><span class="p">)</span> \
                <span class="o">@</span><span class="p">((</span><span class="n">iplus</span> <span class="o">-</span> <span class="n">i0</span><span class="p">)</span><span class="o">/</span><span class="n">s_length</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">dodi</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">oo</span><span class="p">):</span> <span class="k">return</span> <span class="o">-</span><span class="n">pinv</span><span class="p">(</span><span class="n">dFdo</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">oo</span><span class="p">))</span> <span class="o">@</span> <span class="n">dFdi</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">oo</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">dods</span><span class="p">(</span><span class="n">oo</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">s_length</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">iplus</span><span class="p">):</span> <span class="k">return</span> <span class="n">dodi</span><span class="p">(</span>
            <span class="n">i0</span> <span class="o">+</span> <span class="p">(</span><span class="n">s</span><span class="o">/</span><span class="n">s_length</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">iplus</span> <span class="o">-</span> <span class="n">i0</span><span class="p">),</span> <span class="n">oo</span><span class="p">)</span><span class="o">@</span><span class="p">((</span><span class="n">iplus</span> <span class="o">-</span> <span class="n">i0</span><span class="p">)</span><span class="o">/</span><span class="n">s_length</span><span class="p">)</span>

        
    <span class="c1">#  Initialization step: obtaining first solution</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="n">root</span><span class="p">(</span><span class="n">F_io</span><span class="p">,</span> <span class="n">image_init</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="n">domain_bound</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="c1">#  Predictor scheme selection</span>
    <span class="k">if</span> <span class="n">continuation</span> <span class="o">==</span> <span class="s1">&#39;Explicit RK4&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Selected RK4&#39;</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">predict_RK4</span><span class="p">(</span><span class="n">dodi</span><span class="p">,</span><span class="n">i0</span><span class="p">,</span> <span class="n">iplus</span> <span class="p">,</span><span class="n">o0</span><span class="p">):</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">iplus</span> <span class="o">-</span><span class="n">i0</span>
            <span class="n">k1</span> <span class="o">=</span> <span class="n">dodi</span><span class="p">(</span> <span class="n">i0</span>          <span class="p">,</span>  <span class="n">o0</span>           <span class="p">)</span>
            <span class="n">k2</span> <span class="o">=</span> <span class="n">dodi</span><span class="p">(</span> <span class="n">i0</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">h</span><span class="p">,</span>  <span class="n">o0</span> <span class="o">+</span> <span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">@</span> <span class="n">k1</span><span class="p">)</span>
            <span class="n">k3</span> <span class="o">=</span> <span class="n">dodi</span><span class="p">(</span> <span class="n">i0</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">h</span><span class="p">,</span>  <span class="n">o0</span> <span class="o">+</span> <span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">@</span> <span class="n">k1</span><span class="p">)</span>
            <span class="n">k4</span> <span class="o">=</span> <span class="n">dodi</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">i0</span><span class="o">+</span><span class="n">h</span><span class="p">),</span> <span class="n">o0</span> <span class="o">+</span>      <span class="n">h</span><span class="o">@</span> <span class="n">k3</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">o0</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">)</span> <span class="o">@</span> <span class="n">h</span>
        
        <span class="n">predict</span> <span class="o">=</span> <span class="n">predict_RK4</span>
        <span class="n">do_predict</span> <span class="o">=</span> <span class="n">dodi</span>
        
    <span class="k">elif</span> <span class="n">continuation</span> <span class="o">==</span> <span class="s1">&#39;Explicit Euler&#39;</span><span class="p">:</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Selected Euler&#39;</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">predict_eEuler</span><span class="p">(</span><span class="n">dodi</span><span class="p">,</span><span class="n">i0</span><span class="p">,</span> <span class="n">iplus</span> <span class="p">,</span><span class="n">o0</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">o0</span> <span class="o">+</span> <span class="n">dodi</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span><span class="n">o0</span><span class="p">)</span><span class="o">@</span><span class="p">(</span><span class="n">iplus</span> <span class="o">-</span><span class="n">i0</span><span class="p">)</span>
        
        <span class="n">predict</span> <span class="o">=</span> <span class="n">predict_eEuler</span>
        <span class="n">do_predict</span> <span class="o">=</span> <span class="n">dodi</span>
        
    <span class="k">elif</span> <span class="n">continuation</span> <span class="o">==</span> <span class="s1">&#39;odeint&#39;</span><span class="p">:</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Selected odeint&#39;</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">predict_odeint</span><span class="p">(</span><span class="n">dods</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">iplus</span> <span class="p">,</span><span class="n">o0</span><span class="p">):</span>
            <span class="n">s_length</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">iplus</span> <span class="o">-</span> <span class="n">i0</span><span class="p">)</span>
            <span class="n">s_span</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">s_length</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">dods</span><span class="p">,</span> <span class="n">o0</span><span class="p">,</span> <span class="n">s_span</span><span class="p">,</span> <span class="n">s_length</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">iplus</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">sol</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        
        <span class="n">predict</span> <span class="o">=</span> <span class="n">predict_odeint</span>
        <span class="n">do_predict</span> <span class="o">=</span> <span class="n">dods</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ivalid continuation method. Exiting algorithm.&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        
    <span class="c1"># Pre-alocating the domain set</span>
    <span class="n">numInput</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">domain_resolution</span><span class="p">)</span>
    <span class="n">nInput</span> <span class="o">=</span> <span class="n">domain_bound</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nOutput</span> <span class="o">=</span> <span class="n">image_init</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Input_u</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Create discretized AIS based on bounds and resolution information.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nInput</span><span class="p">):</span>
        <span class="n">Input_u</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">domain_bound</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                        <span class="n">domain_bound</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                        <span class="n">domain_resolution</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>

    <span class="n">domain_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">domain_resolution</span> <span class="o">+</span> <span class="p">[</span><span class="n">nInput</span><span class="p">])</span>
    <span class="n">image_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">domain_resolution</span> <span class="o">+</span> <span class="p">[</span><span class="n">nInput</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">image_set</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">x</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numInput</span><span class="p">):</span>
        <span class="n">inputID</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nInput</span>
        <span class="n">inputID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">domain_resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">domain_val</span> <span class="o">=</span> <span class="p">[</span><span class="n">Input_u</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">inputID</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nInput</span><span class="p">):</span>
            <span class="n">inputID</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">domain_resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">j</span><span class="p">])),</span>
                                    <span class="n">domain_resolution</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">domain_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Input_u</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">inputID</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>

        <span class="n">domain_set</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">inputID</span><span class="p">)]</span> <span class="o">=</span> <span class="n">domain_val</span>

    <span class="n">cube_vertices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">nInput</span><span class="p">)):</span>
        <span class="n">cube_vertices</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">binary_repr</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">nInput</span><span class="p">)])</span>
    
    <span class="c1"># Preallocate domain and image polyhedras</span>
    <span class="n">domain_polyhedra</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">image_polyhedra</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>


    <span class="c1"># domain_polyhedra = list()</span>
    <span class="c1"># image_polyhedra = list()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">numInput</span><span class="p">)):</span>
        <span class="n">inputID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">domain_resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nInput</span><span class="p">):</span>
            <span class="n">inputID</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">domain_resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">j</span><span class="p">])),</span>
                                    <span class="n">domain_resolution</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">inputID</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">inputID</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inputID</span><span class="p">]</span>
            <span class="n">ID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">inputID</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">nInput</span><span class="p">)))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cube_vertices</span><span class="p">)</span>

            <span class="n">V_domain_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nInput</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">nInput</span><span class="p">)))</span>
            <span class="n">V_image_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nOutput</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">nInput</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">nInput</span><span class="p">)):</span>
                <span class="n">ID_cell</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ID</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span>

                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">domain_0</span> <span class="o">=</span> <span class="n">domain_set</span><span class="p">[</span><span class="n">ID_cell</span><span class="p">]</span>
                    <span class="n">image_0</span> <span class="o">=</span> <span class="n">image_set</span><span class="p">[</span><span class="n">ID_cell</span><span class="p">]</span>
                    <span class="n">V_domain_id</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">domain_0</span>
                    <span class="n">V_image_id</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_0</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">validation</span> <span class="o">==</span> <span class="s1">&#39;predictor-corrector&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">image_set</span><span class="p">[</span><span class="n">ID_cell</span><span class="p">]))</span> 
                            <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">image_0</span><span class="p">))</span> <span class="o">==</span> <span class="kc">False</span><span class="p">):</span>
                            
                            <span class="n">domain_k</span> <span class="o">=</span> <span class="n">domain_set</span><span class="p">[</span><span class="n">ID_cell</span><span class="p">]</span>
                            <span class="n">V_domain_id</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">domain_k</span>
                            <span class="k">if</span> <span class="n">step_cutting</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">test_img_k</span> <span class="o">=</span> <span class="n">predict_eEuler</span><span class="p">(</span><span class="n">do_predict</span><span class="p">,</span> 
                                                            <span class="n">domain_0</span><span class="p">,</span>
                                                            <span class="n">domain_k</span><span class="p">,</span> 
                                                            <span class="n">image_0</span><span class="p">)</span>
                                <span class="n">domain_k_test</span> <span class="o">=</span> <span class="n">domain_k</span>
                                <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
                                <span class="n">condition</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                                    <span class="nb">abs</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="n">domain_k_test</span><span class="p">,</span> <span class="n">test_img_k</span><span class="p">)))</span>
                                <span class="k">while</span> <span class="p">((</span><span class="n">condition</span> <span class="o">&gt;</span> <span class="n">tol_cor</span> <span class="ow">or</span> 
                                        <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">condition</span><span class="p">))</span> 
                                       <span class="ow">and</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">):</span>

                                    <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
                                    <span class="n">test_img_k</span> <span class="o">=</span> <span class="n">predict_eEuler</span><span class="p">(</span><span class="n">do_predict</span><span class="p">,</span> 
                                                                <span class="n">domain_0</span><span class="p">,</span>
                                                                <span class="n">domain_k_test</span><span class="p">,</span> 
                                                                <span class="n">image_0</span><span class="p">)</span>
                                    <span class="n">domain_k_test</span> <span class="o">=</span> <span class="p">(</span><span class="n">domain_k_test</span><span class="o">*</span><span class="p">(</span><span class="n">count</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> \
                                                     <span class="o">+</span> <span class="n">domain_0</span><span class="p">)</span> <span class="o">/</span> <span class="n">count</span>

                                    <span class="n">condition</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                                        <span class="nb">abs</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="n">domain_k_test</span><span class="p">,</span> <span class="n">test_img_k</span><span class="p">)))</span>

                                
                                <span class="n">domain_k_step_size</span> <span class="o">=</span> <span class="n">domain_k_test</span>
                                <span class="n">domain_kk_minus</span> <span class="o">=</span> <span class="n">domain_0</span>
                                <span class="n">image_kk_minus</span> <span class="o">=</span> <span class="n">image_0</span>
                                <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                                    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
                                        
                                        <span class="n">domain_kk</span> <span class="o">=</span> <span class="n">domain_0</span> <span class="o">+</span> \
                                        <span class="n">domain_k_step_size</span><span class="o">*</span><span class="n">count</span>
                                        
                                        <span class="n">image_kk</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">do_predict</span><span class="p">,</span> 
                                                           <span class="n">domain_kk_minus</span><span class="p">,</span> 
                                                           <span class="n">domain_kk</span><span class="p">,</span> 
                                                           <span class="n">image_kk_minus</span><span class="p">)</span>
                                        <span class="n">image_kk_minus</span> <span class="o">=</span> <span class="n">image_kk</span>

                                <span class="n">image_k</span> <span class="o">=</span> <span class="n">image_kk_minus</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">image_k</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">do_predict</span><span class="p">,</span> 
                                                  <span class="n">domain_0</span><span class="p">,</span> 
                                                  <span class="n">domain_k</span><span class="p">,</span> 
                                                  <span class="n">image_0</span><span class="p">)</span>

                            <span class="n">max_residual</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="n">domain_k</span><span class="p">,</span> <span class="n">image_k</span><span class="p">)))</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">max_residual</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">tol_cor</span> <span class="ow">or</span> 
                                <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">max_residual</span><span class="p">)):</span>
                                
                                <span class="c1"># Call the corrector:</span>
                                <span class="n">sol</span> <span class="o">=</span> <span class="n">root</span><span class="p">(</span><span class="n">F_io</span><span class="p">,</span> <span class="n">image_0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">domain_k</span><span class="p">)</span>
                                <span class="n">found_sol</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">success</span>
                                
                                <span class="c1"># Treat case in which solution is not found:</span>
                                <span class="k">if</span> <span class="n">found_sol</span><span class="p">:</span>
                                    <span class="n">image_k</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">x</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">image_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                                    
                            
                            <span class="n">image_set</span><span class="p">[</span><span class="n">ID_cell</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_k</span>
                            <span class="n">V_image_id</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_k</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">domain_k</span> <span class="o">=</span> <span class="n">domain_set</span><span class="p">[</span><span class="n">ID_cell</span><span class="p">]</span>
                            <span class="n">V_domain_id</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">domain_k</span>
                            <span class="n">image_k</span> <span class="o">=</span> <span class="n">image_set</span><span class="p">[</span><span class="n">ID_cell</span><span class="p">]</span>
                            <span class="n">V_image_id</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_k</span>
                            

                    <span class="k">elif</span> <span class="n">validation</span> <span class="o">==</span> <span class="s1">&#39;predictor&#39;</span><span class="p">:</span> 
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">image_set</span><span class="p">[</span><span class="n">ID_cell</span><span class="p">])):</span>
                            <span class="n">domain_k</span> <span class="o">=</span> <span class="n">domain_set</span><span class="p">[</span><span class="n">ID_cell</span><span class="p">]</span>
                            <span class="n">V_domain_id</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">domain_k</span>
                            
                            <span class="n">image_k</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">do_predict</span><span class="p">,</span>
                                              <span class="n">domain_0</span><span class="p">,</span>
                                              <span class="n">domain_k</span><span class="p">,</span>
                                              <span class="n">image_0</span><span class="p">)</span>
                                                                                     
                            <span class="n">image_set</span><span class="p">[</span><span class="n">ID_cell</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_k</span>
                            <span class="n">V_image_id</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_k</span>
                            
                    <span class="k">elif</span> <span class="n">validation</span> <span class="o">==</span> <span class="s1">&#39;Corrector&#39;</span><span class="p">:</span>     
                        <span class="n">domain_k</span> <span class="o">=</span> <span class="n">domain_set</span><span class="p">[</span><span class="n">ID_cell</span><span class="p">]</span>
                        <span class="n">V_domain_id</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">domain_k</span>
                        
                        <span class="n">sol</span> <span class="o">=</span> <span class="n">root</span><span class="p">(</span><span class="n">F_io</span><span class="p">,</span> <span class="n">image_0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">domain_k</span><span class="p">)</span>
                        <span class="n">image_k</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">x</span>
                        
                        <span class="n">image_set</span><span class="p">[</span><span class="n">ID_cell</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_k</span>
                        <span class="n">V_image_id</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span>    <span class="o">=</span> <span class="n">image_k</span>
                        
            <span class="n">domain_polyhedra</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V_domain_id</span><span class="p">)</span>
            <span class="n">image_polyhedra</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V_image_id</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">domain_set</span><span class="p">,</span> <span class="n">image_set</span><span class="p">,</span> <span class="n">domain_polyhedra</span><span class="p">,</span> <span class="n">image_polyhedra</span></div>


<span class="k">def</span> <span class="nf">get_extreme_vertices</span><span class="p">(</span><span class="n">bounds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the extreme vertices of any D-dimensional hypercube. This is used to</span>
<span class="sd">    plot the DOS in 3d.</span>
<span class="sd">    </span>
<span class="sd">    Author: Victor Alves</span>
<span class="sd">    </span>
<span class="sd">    Control, Optimization and Design for Energy and Sustainability </span>
<span class="sd">    (CODES) Group - West Virginia University - 2022/2023</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bounds : np.ndarray</span>
<span class="sd">        Lower and upper bounds for the Desired Output Set (DOS).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    extreme_vertices : np.ndarray</span>
<span class="sd">        Extreme vertices for the DOS.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_dimensions</span> <span class="o">=</span> <span class="n">bounds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">num_points</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">num_dimensions</span>

    <span class="n">extreme_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_points</span><span class="p">,</span> <span class="n">num_dimensions</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_dimensions</span><span class="p">):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_points</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>
        <span class="n">extreme_vertices</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">indices</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">extreme_vertices</span>
</pre></div>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Victor Alves @ Control, Optimization and Design for Energy and Sustainability (CODES) Group.
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      ¬© Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>